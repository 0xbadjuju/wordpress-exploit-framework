module Cli
  # Helper methods for generating tabular output.
  module TableOutputHelper
    def initialize
      super
      self.indent_level = 1 if indent_level.nil?
      self.indent = '  ' if indent.nil?
    end

    def calculate_col_widths(data)
      widths = {}
      data.each do |row|
        row.keys.each do |col|
          if widths[col].nil? || row[col].to_s.length > widths[col]
            widths[col] = row[col].to_s.length
          end
        end
      end
      widths
    end

    def build_header_separator(widths)
      separators = {}
      widths.keys.each do |col|
        separators[col] = '-' * widths[col]
      end

      build_table_row(separators, widths)
    end

    def build_table_row(data, widths)
      row = indent * indent_level
      data.keys.each do |col|
        padding = widths[col] - data[col].to_s.length
        row += "#{data[col]}#{' ' * padding}   "
      end
      row += "\n"
    end

    def build_table(data, pad_with_new_lines = false)
      table = ''
      table += "\n" if pad_with_new_lines
      widths = calculate_col_widths(data)
      data.each_with_index do |row, index|
        table += build_table_row(row, widths)
        table += build_header_separator(widths) if index == 0
      end
      table += "\n" if pad_with_new_lines
      table
    end

    attr_accessor :indent
    attr_accessor :indent_level
  end
end
