module Web
  module Controllers
    # Controller to handle all routes relating to modules.
    class Modules < Base
      get '/list/:type' do
        halt unless params['type'].eql?('exploit') || params['type'].eql?('auxiliary')

        module_namespace = params['type'].eql?('auxiliary') ? Wpxf::Auxiliary : Wpxf::Exploit

        classes = module_namespace.constants.select do |c|
          module_namespace.const_get(c).is_a? Class
        end

        modules = {}
        modules[params['type']] = classes.map do |c|
          instance = module_namespace.const_get(c).new
          {
            path: "#{params['type']}/#{Wpxf.underscore(c.to_s)}",
            title: instance.module_name,
            desc: instance.module_desc,
            date: instance.module_date
          }
        end

        json modules[params['type']]
      end
    end
  end
end
