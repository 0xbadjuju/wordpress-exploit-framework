module Web
  module Controllers
    # Controller to handle all routes relating to payloads.
    class Payloads < Base
      helpers Web::Helpers::OptionsHelper

      get '/' do
        classes = Wpxf::Payloads.constants.select do |c|
          Wpxf::Payloads.const_get(c).is_a? Class
        end

        payloads = classes.map do |c|
          payload = Wpxf::Payloads.const_get(c).new
          {
            name: Wpxf.underscore(c.to_s),
            desc: payload.description,
            options: options_hash(payload.options)
          }
        end

        json payloads
      end
    end
  end
end
