import { Component, Input, Output, OnInit, EventEmitter } from '@angular/core'
import { FormsModule }       from '@angular/forms';

import { ModuleOption } from '../shared/module-option'

@Component({
  selector: 'module-option',
  moduleId: module.id,
  templateUrl: 'module-option.component.html',
  styles: [`input.boolean-option { margin-top: 9px; }`],
})

export class ModuleOptionComponent implements OnInit {
  private controlType: string;
  private invalid: boolean;
  private showOption: boolean;

  @Input() option: ModuleOption;
  @Input() showAdvanced: boolean;
  @Output() update: EventEmitter<any> = new EventEmitter<any>();

  ngOnInit(): void {
    switch (this.option.type) {
      case 'Wpxf::StringOption':
        this.controlType = 'text';
        break;

      case 'Wpxf::IntegerOption':
        this.controlType = 'number';
        break;

      case 'Wpxf::PortOption':
        this.controlType = 'number';
        this.option.min = 0;
        this.option.max = 65535;
        break;

      case 'Wpxf::BooleanOption':
        this.controlType = 'checkbox';
        break;
    }

    this.updateValue(this.option.default);
    this.showOption = (this.option.advanced && this.showAdvanced) || (!this.option.advanced && !this.showAdvanced);
  }

  updateValue(value: any): void {
    this.option.value = value;

    if (this.option.required && this.controlType != 'checkbox' && (value === null || value == '')) {
      this.invalid = true;
    }
    else if (this.option.regex != null) {
      var regex = new RegExp(this.option.regex);
      this.invalid = !regex.test(value);
    }
    else {
      this.invalid = false;
    }

    this.update.emit({ invalid: this.invalid, value: value });
  }

  updateCheckBoxValue(event: any): void {
    if (this.controlType !== 'checkbox') {
      return;
    }

    this.updateValue(event.currentTarget.checked);
  }

  isValid(): boolean {
    return !this.showOption || !this.invalid;
  }
}
