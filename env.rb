wpxfbase = __FILE__
while File.symlink?(wpxfbase)
  wpxfbase = File.expand_path(File.readlink(wpxfbase), File.dirname(wpxfbase))
end

app_path = File.expand_path(File.join(File.dirname(wpxfbase)))
$LOAD_PATH.unshift(app_path, 'lib')
$LOAD_PATH.unshift(app_path, 'modules')

require 'active_record'
require 'colorize'
require 'date'
require 'json'
require 'require_all'
require 'time'
require 'typhoeus'
require 'zip'
require 'yaml'

require 'wpxf/core'
require 'wpxf/utility/body_builder'
require 'wpxf/utility/text'
require 'wpxf/utility/reference_inflater'

module Wpxf
  def self.data_directory=(val)
    @@data_directory = val
  end

  def self.data_directory
    @@data_directory
  end

  def self.change_stdout_sync(enabled)
    original_setting = STDOUT.sync
    STDOUT.sync = true
    yield(enabled)
    STDOUT.sync = original_setting
  end
end

Wpxf.data_directory = File.join(app_path, 'data/')

# Setup ActiveRecord
db_config = YAML.load_file('db/config.yml')
ENV['RACK_ENV'] = 'development' unless ENV['RACK_ENV']
ActiveRecord::Base.establish_connection(
  adapter: db_config[ENV['RACK_ENV']]['adapter'],
  database: db_config[ENV['RACK_ENV']]['database']
)
